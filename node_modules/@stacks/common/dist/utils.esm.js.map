{"version":3,"file":"utils.esm.js","sources":["../src/utils.ts"],"sourcesContent":["import { Logger } from './logger';\n\n/**\n *  @ignore\n */\nexport const BLOCKSTACK_HANDLER = 'blockstack';\n\n/**\n * Time\n * @private\n * @ignore\n */\nexport function nextYear() {\n  return new Date(new Date().setFullYear(new Date().getFullYear() + 1));\n}\n\n/**\n * Time\n * @private\n * @ignore\n */\nexport function nextMonth() {\n  return new Date(new Date().setMonth(new Date().getMonth() + 1));\n}\n\n/**\n * Time\n * @private\n * @ignore\n */\nexport function nextHour() {\n  return new Date(new Date().setHours(new Date().getHours() + 1));\n}\n\n/**\n * Converts megabytes to bytes. Returns 0 if the input is not a finite number.\n * @ignore\n */\nexport function megabytesToBytes(megabytes: number): number {\n  if (!Number.isFinite(megabytes)) {\n    return 0;\n  }\n  return Math.floor(megabytes * 1024 * 1024);\n}\n\n/**\n * Calculate the AES-CBC ciphertext output byte length a given input length.\n * AES has a fixed block size of 16-bytes regardless key size.\n * @ignore\n */\nexport function getAesCbcOutputLength(inputByteLength: number) {\n  // AES-CBC block mode rounds up to the next block size.\n  const cipherTextLength = (Math.floor(inputByteLength / 16) + 1) * 16;\n  return cipherTextLength;\n}\n\n/**\n * Calculate the base64 encoded string length for a given input length.\n * This is equivalent to the byte length when the string is ASCII or UTF8-8\n * encoded.\n * @param number\n */\nexport function getBase64OutputLength(inputByteLength: number) {\n  const encodedLength = Math.ceil(inputByteLength / 3) * 4;\n  return encodedLength;\n}\n\n/**\n * Query Strings\n * @private\n * @ignore\n */\n\nexport function updateQueryStringParameter(uri: string, key: string, value: string) {\n  const re = new RegExp(`([?&])${key}=.*?(&|$)`, 'i');\n  const separator = uri.indexOf('?') !== -1 ? '&' : '?';\n  if (uri.match(re)) {\n    return uri.replace(re, `$1${key}=${value}$2`);\n  } else {\n    return `${uri}${separator}${key}=${value}`;\n  }\n}\n\n/**\n * Versioning\n * @param {string} v1 - the left half of the version inequality\n * @param {string} v2 - right half of the version inequality\n * @returns {bool} iff v1 >= v2\n * @private\n * @ignore\n */\n\nexport function isLaterVersion(v1: string, v2: string) {\n  if (v1 === undefined || v1 === '') {\n    v1 = '0.0.0';\n  }\n\n  if (v2 === undefined || v1 === '') {\n    v2 = '0.0.0';\n  }\n\n  const v1tuple = v1.split('.').map(x => parseInt(x, 10));\n  const v2tuple = v2.split('.').map(x => parseInt(x, 10));\n\n  for (let index = 0; index < v2.length; index++) {\n    if (index >= v1.length) {\n      v2tuple.push(0);\n    }\n    if (v1tuple[index] < v2tuple[index]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * UUIDs\n * @private\n * @ignore\n */\nexport function makeUUID4() {\n  let d = new Date().getTime();\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\n    d += performance.now(); // use high-precision timer if available\n  }\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {\n    const r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c === 'x' ? r : (r & 0x3) | 0x8).toString(16);\n  });\n}\n\n/**\n * Checks if both urls pass the same origin check & are absolute\n * @param  {[type]}  uri1 first uri to check\n * @param  {[type]}  uri2 second uri to check\n * @return {Boolean} true if they pass the same origin check\n * @private\n * @ignore\n */\nexport function isSameOriginAbsoluteUrl(uri1: string, uri2: string) {\n  try {\n    // The globally scoped WHATWG `URL` class is available in modern browsers and\n    // NodeJS v10 or higher. In older NodeJS versions it must be required from the\n    // `url` module.\n    let parseUrl: (url: string) => URL;\n    if (typeof URL !== 'undefined') {\n      parseUrl = url => new URL(url);\n    } else {\n      try {\n        // eslint-disable-next-line import/no-nodejs-modules, global-require\n        const nodeUrl = (require('url') as typeof import('url')).URL;\n        parseUrl = url => new nodeUrl(url);\n      } catch (error) {\n        console.log(error);\n        throw new Error('Global URL class is not available');\n      }\n    }\n\n    const parsedUri1 = parseUrl(uri1);\n    const parsedUri2 = parseUrl(uri2);\n\n    const port1 =\n      parseInt(parsedUri1.port || '0', 10) | 0 || (parsedUri1.protocol === 'https:' ? 443 : 80);\n    const port2 =\n      parseInt(parsedUri2.port || '0', 10) | 0 || (parsedUri2.protocol === 'https:' ? 443 : 80);\n\n    const match = {\n      scheme: parsedUri1.protocol === parsedUri2.protocol,\n      hostname: parsedUri1.hostname === parsedUri2.hostname,\n      port: port1 === port2,\n      absolute:\n        (uri1.includes('http://') || uri1.includes('https://')) &&\n        (uri2.includes('http://') || uri2.includes('https://')),\n    };\n\n    return match.scheme && match.hostname && match.port && match.absolute;\n  } catch (error) {\n    console.log(error);\n    console.log('Parsing error in same URL origin check');\n    // Parse error\n    return false;\n  }\n}\n\n/**\n * Returns the global scope `Window`, `WorkerGlobalScope`, or `NodeJS.Global` if available in the\n * currently executing environment.\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/self\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WorkerGlobalScope/self\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope\n *\n * This could be switched to `globalThis` once it is standardized and widely available.\n * @see https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis\n * @ignore\n */\nexport function getGlobalScope(): Window {\n  if (typeof self !== 'undefined') {\n    return self;\n  }\n  if (typeof window !== 'undefined') {\n    return window;\n  }\n  // This function is meant to be called when accessing APIs that are typically only available in\n  // web-browser/DOM environments, but we also want to support situations where running in Node.js\n  // environment, and a polyfill was added to the Node.js `global` object scope without adding the\n  // `window` global object as well.\n  if (typeof global !== 'undefined') {\n    return (global as unknown) as Window;\n  }\n  throw new Error(\n    'Unexpected runtime environment - no supported global scope (`window`, `self`, `global`) available'\n  );\n}\n\nfunction getAPIUsageErrorMessage(\n  scopeObject: unknown,\n  apiName: string,\n  usageDesc?: string\n): string {\n  if (usageDesc) {\n    return `Use of '${usageDesc}' requires \\`${apiName}\\` which is unavailable on the '${scopeObject}' object within the currently executing environment.`;\n  } else {\n    return `\\`${apiName}\\` is unavailable on the '${scopeObject}' object within the currently executing environment.`;\n  }\n}\n\ninterface GetGlobalObjectOptions {\n  /**\n   * Throw an error if the object is not found.\n   * @default false\n   */\n  throwIfUnavailable?: boolean;\n  /**\n   * Additional information to include in an error if thrown.\n   */\n  usageDesc?: string;\n  /**\n   * If the object is not found, return an new empty object instead of undefined.\n   * Requires [[throwIfUnavailable]] to be falsey.\n   * @default false\n   */\n  returnEmptyObject?: boolean;\n}\n\n/**\n * Returns an object from the global scope (`Window` or `WorkerGlobalScope`) if it\n * is available within the currently executing environment.\n * When executing within the Node.js runtime these APIs are unavailable and will be\n * `undefined` unless the API is provided via polyfill.\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/self\n * @ignore\n */\nexport function getGlobalObject<K extends Extract<keyof Window, string>>(\n  name: K,\n  { throwIfUnavailable, usageDesc, returnEmptyObject }: GetGlobalObjectOptions = {}\n): Window[K] | undefined {\n  let globalScope: Window | undefined = undefined;\n  try {\n    globalScope = getGlobalScope();\n    if (globalScope) {\n      const obj = globalScope[name];\n      if (obj) {\n        return obj;\n      }\n    }\n  } catch (error) {\n    Logger.error(`Error getting object '${name}' from global scope '${globalScope}': ${error}`);\n  }\n  if (throwIfUnavailable) {\n    const errMsg = getAPIUsageErrorMessage(globalScope, name.toString(), usageDesc);\n    Logger.error(errMsg);\n    throw new Error(errMsg);\n  }\n  if (returnEmptyObject) {\n    return {} as any;\n  }\n  return undefined;\n}\n\n/**\n * Returns a specified subset of objects from the global scope (`Window` or `WorkerGlobalScope`)\n * if they are available within the currently executing environment.\n * When executing within the Node.js runtime these APIs are unavailable will be `undefined`\n * unless the API is provided via polyfill.\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/self\n * @ignore\n */\nexport function getGlobalObjects<K extends Extract<keyof Window, string>>(\n  names: K[],\n  { throwIfUnavailable, usageDesc, returnEmptyObject }: GetGlobalObjectOptions = {}\n): Pick<Window, K> {\n  let globalScope: Window | undefined;\n  try {\n    globalScope = getGlobalScope();\n  } catch (error) {\n    Logger.error(`Error getting global scope: ${error}`);\n    if (throwIfUnavailable) {\n      const errMsg = getAPIUsageErrorMessage(globalScope, names[0].toString(), usageDesc);\n      Logger.error(errMsg);\n      throw errMsg;\n    } else if (returnEmptyObject) {\n      globalScope = {} as any;\n    }\n  }\n\n  const result: Pick<Window, K> = {} as any;\n  for (let i = 0; i < names.length; i++) {\n    const name = names[i];\n    try {\n      if (globalScope) {\n        const obj = globalScope[name];\n        if (obj) {\n          result[name] = obj;\n        } else if (throwIfUnavailable) {\n          const errMsg = getAPIUsageErrorMessage(globalScope, name.toString(), usageDesc);\n          Logger.error(errMsg);\n          throw new Error(errMsg);\n        } else if (returnEmptyObject) {\n          result[name] = {} as any;\n        }\n      }\n    } catch (error) {\n      if (throwIfUnavailable) {\n        const errMsg = getAPIUsageErrorMessage(globalScope, name.toString(), usageDesc);\n        Logger.error(errMsg);\n        throw new Error(errMsg);\n      }\n    }\n  }\n  return result;\n}\n"],"names":["BLOCKSTACK_HANDLER","nextYear","Date","setFullYear","getFullYear","nextMonth","setMonth","getMonth","nextHour","setHours","getHours","megabytesToBytes","megabytes","Number","isFinite","Math","floor","getAesCbcOutputLength","inputByteLength","cipherTextLength","getBase64OutputLength","encodedLength","ceil","updateQueryStringParameter","uri","key","value","re","RegExp","separator","indexOf","match","replace","isLaterVersion","v1","v2","undefined","v1tuple","split","map","x","parseInt","v2tuple","index","length","push","makeUUID4","d","getTime","performance","now","c","r","random","toString","isSameOriginAbsoluteUrl","uri1","uri2","parseUrl","URL","url","nodeUrl","require","error","console","log","Error","parsedUri1","parsedUri2","port1","port","protocol","port2","scheme","hostname","absolute","includes","getGlobalScope","self","window","global","getAPIUsageErrorMessage","scopeObject","apiName","usageDesc","getGlobalObject","name","throwIfUnavailable","returnEmptyObject","globalScope","obj","Logger","errMsg","getGlobalObjects","names","result","i"],"mappings":"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"}